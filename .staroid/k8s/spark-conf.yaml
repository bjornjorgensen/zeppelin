kind: ConfigMap
apiVersion: v1
metadata:
  name: spark-initial-conf
data:
  spark-defaults.conf: spark.sql.catalogImplementation                       hive
  runtime-initialize-spark-defaults.sh: |
    #!/bin/bash
    SPARK_DEFAULTS_CONF=/spark/conf/spark-defaults.conf

    # generate hive metastore connection info
    echo $HIVE_METASTORE_NAMESPACE | grep not-imported > /dev/null
    if [ $? -ne 0 ]; then
      # add a newline
      echo "" >> $SPARK_DEFAULTS_CONF
      # add generated metastore uri
      cat <<EOT >> $SPARK_DEFAULTS_CONF
    spark.hadoop.hive.metastore.uris  thrift://$HIVE_METASTORE_SERVICE.$HIVE_METASTORE_NAMESPACE:9083
    EOT
    fi
  image: opendatastudio/spark:v3.0.0
